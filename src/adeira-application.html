<link rel="import" href="adeira-cardsGrid.html">
<link rel="import" href="adeira-leftMenu.html">
<link rel="import" href="adeira-loginForm.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../bower_components/paper-styles/shadow.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">

<dom-module id="adeira-application">

	<template>
		<style>
			paper-scroll-header-panel {
				height: 100%;
			}

			paper-drawer-panel {
				--paper-drawer-panel-left-drawer-container: {
					@apply(--shadow-elevation-2dp);
				};
			}

			paper-toolbar a {
				color: inherit;
				text-decoration: inherit;
			}

			.paper-font-headline {
				@apply(--paper-font-headline);
			}

			.shadow-elevation-2dp {
				@apply(--shadow-elevation-2dp);
			}

			@media (min-width: 768px) {
				paper-icon-button {
					display: none
				}
			}
		</style>

		<app-location route="{{route}}" use-hash-as-path></app-location>
		<app-route
				route="{{route}}"
				pattern="/:page"
				data="{{routeData}}"
				tail="{{subroute}}">
		</app-route>
		<app-route
				route="{{subroute}}"
				pattern="/:id"
				data="{{subrouteData}}">
		</app-route>

		<paper-scroll-header-panel class="flex">

			<paper-toolbar class="shadow-elevation-2dp">
				<paper-icon-button icon="menu" on-tap="toggleDrawer"></paper-icon-button>
				<a href="#/">
					<h1 class="paper-font-headline">Adeira<strong>:connector</strong></h1>
				</a>
			</paper-toolbar>

			<!--<iron-ajax-->
					<!--auto-->
					<!--url="/graphql"-->
					<!--body='{device(id:"58d200ad-6376-4c01-9b6d-2ea536f1cd2c"){id,name,records(first:1)}}'-->
					<!--method="POST"-->
					<!--handle-as="json"-->
					<!--on-response="handleResponse">-->
			<!--</iron-ajax>-->

			<template is="dom-if" if="{{!user.loggedIn}}">
				<div main>
					<h1>Please log in</h1>
					<adeira-loginForm/>
				</div>
			</template>

			<template is="dom-if" if="{{user.loggedIn}}">
				<paper-drawer-panel style="position:relative" id="drawerPanel">
					<adeira-leftMenu drawer id="drawer" selected="{{routeData.page}}"></adeira-leftMenu>

					<!-- https://www.polymer-project.org/1.0/toolbox/routing -->
					<iron-pages main role="main" selected="{{routeData.page}}" attr-for-selected="page" style="overflow-y: auto">
						<div page="">
							<adeira-cardsGrid page="inbound" route="{{subroute}}"></adeira-cardsGrid>
						</div>
						<div page="inbound">
							inbound
						</div>
					</iron-pages>
				</paper-drawer-panel>
			</template>

		</paper-scroll-header-panel>
	</template>

	<script>
		Polymer({
			is: 'adeira-application',
			properties: {
				user: {
					type: Object,
					value: {
						loggedIn: false
					}
				}
			},
			toggleDrawer: function () {
				this.$.drawerPanel.togglePanel();
			},
			attached: function () {
				if (this.route.path === '' || !this.user.loggedIn) {
					//TODO: 404 (?)
					this.set('route.path', '/');
				}
			},
			handleResponse: function () {
				this.set('user.loggedIn', true); // do not use 'this.user.loggedIn', change must be observable (https://www.polymer-project.org/1.0/docs/devguide/data-system#observable-changes)
			}
		});
	</script>

</dom-module>
